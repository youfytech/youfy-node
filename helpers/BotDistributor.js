const a40_0x5ef175=a40_0x5aff;function a40_0xad0a(){const _0x50bd0e=['1462080yDcBlk','mkdir\x20-p\x20','holder_dir','703728HJEtIy','../','package.json','workspace_dir','info','moveToBaseDir','/apps/','484200zEiJFP','createWorkspacePkgJson','mv\x20','/shared/','Alan\x20Bacelar\x20<alan@youfy.com.br>','inherit','Install\x20bot\x20dependecies...','./src/assets/**','pkg_dir','1869swogps','dist','getPackage','stringify','assets','./index.js','opts','/tmp/yfy_bot_workspace_dist','error','ISC','1287075sLdhbu','_copyDirIfExists','**/*.js','12RiFxlg','./src/index.js','bin','**/*.html','isArray','pkg\x20--public-packages\x20\x22*\x22\x20.\x20--public','200BaHfCX','540450icOHRA','removeBaseDistDir','copySourceFiles','bot_dir','output_dir','43056HZJnvo','removeTempFiles','copySharedFiles','rsync\x20--recursive\x20--exclude\x20\x27node_modules\x27\x20--exclude\x20\x27.git\x27\x20','5416OMTUlT','scripts','/dist','dist_dir','/common/','bots','changePkgForDist','_copyDir','pkg','holder_name','installDepedencies','yarn\x20install','shared','base_dir'];a40_0xad0a=function(){return _0x50bd0e;};return a40_0xad0a();}(function(_0x48d50c,_0x3d4f0b){const _0x48b4be=a40_0x5aff,_0x35074c=_0x48d50c();while(!![]){try{const _0x2ec228=-parseInt(_0x48b4be(0x217))/0x1+parseInt(_0x48b4be(0x200))/0x2+-parseInt(_0x48b4be(0x221))/0x3+parseInt(_0x48b4be(0x1f9))/0x4*(parseInt(_0x48b4be(0x1f6))/0x5)+parseInt(_0x48b4be(0x205))/0x6+parseInt(_0x48b4be(0x1ec))/0x7*(-parseInt(_0x48b4be(0x209))/0x8)+-parseInt(_0x48b4be(0x21a))/0x9*(-parseInt(_0x48b4be(0x1ff))/0xa);if(_0x2ec228===_0x3d4f0b)break;else _0x35074c['push'](_0x35074c['shift']());}catch(_0xcee8d9){_0x35074c['push'](_0x35074c['shift']());}}}(a40_0xad0a,0xc591f));function a40_0x5aff(_0x1c09da,_0x464395){const _0xad0aff=a40_0xad0a();return a40_0x5aff=function(_0x5aff15,_0x8024e5){_0x5aff15=_0x5aff15-0x1ec;let _0x251977=_0xad0aff[_0x5aff15];return _0x251977;},a40_0x5aff(_0x1c09da,_0x464395);}const log=require('./logger'),findWorkspaceRoot=require('find-yarn-workspace-root'),{execSync}=require('child_process'),{resolve,basename}=require('path'),{writeFileSync,existsSync}=require('fs');class BotDistributor{constructor(_0x1c36a9){const _0x3d5e96=a40_0x5aff;this[_0x3d5e96(0x1f2)]={'base_dir':process['cwd'](),'output_dir':_0x3d5e96(0x1f3),..._0x1c36a9},this[_0x3d5e96(0x229)]=resolve(this[_0x3d5e96(0x1f2)][_0x3d5e96(0x216)],'package.json'),this[_0x3d5e96(0x211)]=this[_0x3d5e96(0x1ee)](),this[_0x3d5e96(0x21d)]=findWorkspaceRoot(this['opts']['base_dir'])||this[_0x3d5e96(0x1f2)][_0x3d5e96(0x216)],this['holder_dir']=resolve(this[_0x3d5e96(0x1f2)][_0x3d5e96(0x216)],_0x3d5e96(0x21b)),this[_0x3d5e96(0x212)]=basename(this[_0x3d5e96(0x219)]),this[_0x3d5e96(0x203)]=resolve(this[_0x3d5e96(0x1f2)][_0x3d5e96(0x204)],basename(this['pkg']['name'])),this['dist_dir']=resolve(this[_0x3d5e96(0x203)],_0x3d5e96(0x1ed));}[a40_0x5ef175(0x1ee)](){const _0x339242=a40_0x5ef175;try{return require(this.pkg_dir);}catch(_0xfddfaf){return console[_0x339242(0x1f4)]('Package.json\x20not\x20found.\x20It\x20should\x20be\x20in\x20the\x20root\x20of\x20the\x20project.'),{};}}['_copyDir'](_0x170654,_0x1789e6,{cwd:_0x2b5a7a}={}){const _0x249626=a40_0x5ef175;execSync(_0x249626(0x208)+_0x170654+'\x20'+_0x1789e6,{'stdio':_0x249626(0x226),'cwd':_0x2b5a7a});}['_copyDirIfExists'](_0x4b8d44,_0xcd2815,_0x5392f6){const _0x3c9018=a40_0x5ef175;existsSync(_0x4b8d44)&&this[_0x3c9018(0x210)](_0x4b8d44,_0xcd2815,_0x5392f6);}[a40_0x5ef175(0x206)](){const _0x2c651e=a40_0x5ef175,{output_dir:_0x5deff9}=this['opts'];execSync('rm\x20-Rf\x20'+_0x5deff9),execSync('rm\x20-Rf\x20'+this[_0x2c651e(0x20c)]);}[a40_0x5ef175(0x202)](){const _0x2583c2=a40_0x5ef175;log[_0x2583c2(0x21e)]('Coping\x20bot\x20files...'),execSync('mkdir\x20-p\x20'+this[_0x2583c2(0x203)]);const {base_dir:_0xf51c47}=this[_0x2583c2(0x1f2)];this[_0x2583c2(0x210)]('*',this[_0x2583c2(0x203)],{'cwd':_0xf51c47});}[a40_0x5ef175(0x207)](){const _0x132fb8=a40_0x5ef175;log['info']('Coping\x20shared\x20files...');const _0x54e195=this[_0x132fb8(0x1f2)]['output_dir'];execSync(_0x132fb8(0x218)+_0x54e195+'/'+this[_0x132fb8(0x212)]),execSync(_0x132fb8(0x218)+_0x54e195+'/apps'),this['_copyDirIfExists'](this[_0x132fb8(0x21d)]+_0x132fb8(0x224),_0x54e195+_0x132fb8(0x224)),this[_0x132fb8(0x1f7)](this['holder_dir']+'/common/',_0x54e195+'/'+this[_0x132fb8(0x212)]+_0x132fb8(0x20d)),this[_0x132fb8(0x1f7)](this['holder_dir']+_0x132fb8(0x220),_0x54e195+'/'+this['holder_name']+'/apps');const _0x383c28=this[_0x132fb8(0x211)]['apps']||[];for(const _0x3c2d64 of _0x383c28){this['_copyDir'](this[_0x132fb8(0x21d)]+_0x132fb8(0x220)+_0x3c2d64+'/',_0x54e195+_0x132fb8(0x220)+_0x3c2d64+'/');}}[a40_0x5ef175(0x213)](){const _0x5372f8=a40_0x5ef175;log[_0x5372f8(0x21e)](_0x5372f8(0x227));const {output_dir:_0x1a3da0}=this[_0x5372f8(0x1f2)];execSync(_0x5372f8(0x214),{'stdio':_0x5372f8(0x226),'cwd':_0x1a3da0});}['changePkgForDist'](){const _0xd5fc2f=a40_0x5ef175,_0x4cfc7b=this['pkg'];_0x4cfc7b['bin']=_0x4cfc7b[_0xd5fc2f(0x1fb)]||_0xd5fc2f(0x1f1),_0x4cfc7b['main']=_0x4cfc7b['main']||_0xd5fc2f(0x1fa);const _0x1513d1=_0x4cfc7b['pkg_extras']||{},_0x290eed=Array[_0xd5fc2f(0x1fd)](_0x1513d1[_0xd5fc2f(0x1f0)])?_0x1513d1[_0xd5fc2f(0x1f0)]:_0x1513d1['assets']?[_0x1513d1[_0xd5fc2f(0x1f0)]]:[];_0x4cfc7b[_0xd5fc2f(0x211)]={'scripts':[_0xd5fc2f(0x1f8),..._0x1513d1['scripts']||[]],'assets':[_0xd5fc2f(0x228),_0xd5fc2f(0x1fc),..._0x290eed],'outputPath':'dist'},_0x4cfc7b[_0xd5fc2f(0x20a)]={..._0x4cfc7b[_0xd5fc2f(0x20a)],'dist':_0xd5fc2f(0x1fe)},writeFileSync(resolve(this[_0xd5fc2f(0x203)],_0xd5fc2f(0x21c)),JSON[_0xd5fc2f(0x1ef)](_0x4cfc7b));}[a40_0x5ef175(0x1ed)](){const _0x504df2=a40_0x5ef175;this['removeTempFiles'](),this['copySourceFiles'](),this[_0x504df2(0x207)](),this[_0x504df2(0x222)](),this[_0x504df2(0x20f)](),this['installDepedencies'](),execSync('yarn\x20dist',{'stdio':_0x504df2(0x226),'cwd':this[_0x504df2(0x203)]});}[a40_0x5ef175(0x21f)](){const _0x5a9b07=a40_0x5ef175;execSync(_0x5a9b07(0x223)+this['dist_dir']+'\x20'+this[_0x5a9b07(0x1f2)][_0x5a9b07(0x216)]+_0x5a9b07(0x20b));}[a40_0x5ef175(0x201)](){const _0x2bfdc3=a40_0x5ef175;execSync('rm\x20-Rf\x20'+this[_0x2bfdc3(0x1f2)][_0x2bfdc3(0x216)]+'/dist');}[a40_0x5ef175(0x222)](){const _0x2fd9f8=a40_0x5ef175,_0x5e14bb={'name':_0x2fd9f8(0x20e),'private':!![],'workspaces':{'packages':[basename(this[_0x2fd9f8(0x203)]),_0x2fd9f8(0x215),'apps/*',this[_0x2fd9f8(0x212)]+'/*']},'author':_0x2fd9f8(0x225),'license':_0x2fd9f8(0x1f5)};writeFileSync(resolve(this[_0x2fd9f8(0x1f2)][_0x2fd9f8(0x204)],_0x2fd9f8(0x21c)),JSON[_0x2fd9f8(0x1ef)](_0x5e14bb));}}module['exports']=BotDistributor;