const a40_0x14428d=a40_0x32aa;function a40_0x32aa(_0x5d7708,_0x5b9104){const _0x3d7c37=a40_0x3d7c();return a40_0x32aa=function(_0x32aabd,_0xb60ed0){_0x32aabd=_0x32aabd-0x79;let _0x3d467b=_0x3d7c37[_0x32aabd];return _0x3d467b;},a40_0x32aa(_0x5d7708,_0x5b9104);}(function(_0x442e81,_0x1a5615){const _0x1e2880=a40_0x32aa,_0x51a764=_0x442e81();while(!![]){try{const _0x40a2d5=-parseInt(_0x1e2880(0xa9))/0x1*(parseInt(_0x1e2880(0x93))/0x2)+-parseInt(_0x1e2880(0x87))/0x3*(-parseInt(_0x1e2880(0x7a))/0x4)+parseInt(_0x1e2880(0x8d))/0x5*(-parseInt(_0x1e2880(0x92))/0x6)+parseInt(_0x1e2880(0xaf))/0x7+-parseInt(_0x1e2880(0xab))/0x8+parseInt(_0x1e2880(0xb6))/0x9*(parseInt(_0x1e2880(0x7b))/0xa)+-parseInt(_0x1e2880(0xac))/0xb*(-parseInt(_0x1e2880(0xb7))/0xc);if(_0x40a2d5===_0x1a5615)break;else _0x51a764['push'](_0x51a764['shift']());}catch(_0x41e718){_0x51a764['push'](_0x51a764['shift']());}}}(a40_0x3d7c,0xdbe49));const log=require('./logger'),findWorkspaceRoot=require('find-yarn-workspace-root'),{execSync}=require('child_process'),{resolve,basename}=require('path'),{writeFileSync,existsSync}=require('fs');function a40_0x3d7c(){const _0x22ffe4=['name','moveToBaseDir','**/*.html','error','/common/','dist_dir','_copyDir','pkg_extras','scripts','./index.js','dist','bin','rsync\x20--recursive\x20--exclude\x20\x27node_modules\x27\x20--exclude\x20\x27.git\x27\x20','info','Package.json\x20not\x20found.\x20It\x20should\x20be\x20in\x20the\x20root\x20of\x20the\x20project.','./src/index.js','removeBaseDistDir','workspace_dir','20523kwJtHY','ISC','7296896lWkKXf','66wEJaSO','shared','/dist','2564877QnTwek','opts','Coping\x20shared\x20files...','createWorkspacePkgJson','/apps/','bot_dir','yarn\x20install','18rZZYho','3722088UXaprX','copySourceFiles','cwd','main','**/*.js','85548sxUASQ','5638170htchak','base_dir','mkdir\x20-p\x20','/apps','/shared/','installDepedencies','output_dir','pkg','../','isArray','changePkgForDist','holder_dir','9jCvCWH','package.json','stringify','assets','Alan\x20Bacelar\x20<alan@youfy.com.br>','rm\x20-Rf\x20','490zFYoNR','pkg\x20--public-packages\x20\x22*\x22\x20.\x20--public','removeTempFiles','getPackage','inherit','97098SzOJLB','2mQPVrS','_copyDirIfExists','holder_name','apps'];a40_0x3d7c=function(){return _0x22ffe4;};return a40_0x3d7c();}class BotDistributor{constructor(_0x22800b){const _0x388d66=a40_0x32aa;this['opts']={'base_dir':process[_0x388d66(0xb9)](),'output_dir':'/tmp/yfy_bot_workspace_dist',..._0x22800b},this['pkg_dir']=resolve(this[_0x388d66(0xb0)][_0x388d66(0x7c)],'package.json'),this[_0x388d66(0x82)]=this[_0x388d66(0x90)](),this[_0x388d66(0xa8)]=findWorkspaceRoot(this['opts'][_0x388d66(0x7c)])||this['opts']['base_dir'],this['holder_dir']=resolve(this[_0x388d66(0xb0)][_0x388d66(0x7c)],_0x388d66(0x83)),this[_0x388d66(0x95)]=basename(this['holder_dir']),this[_0x388d66(0xb4)]=resolve(this['opts']['output_dir'],basename(this[_0x388d66(0x82)][_0x388d66(0x97)])),this[_0x388d66(0x9c)]=resolve(this[_0x388d66(0xb4)],_0x388d66(0xa1));}['getPackage'](){const _0x34fc9b=a40_0x32aa;try{return require(this.pkg_dir);}catch(_0x4b6bfe){return console[_0x34fc9b(0x9a)](_0x34fc9b(0xa5)),{};}}['_copyDir'](_0x16c37c,_0x1ee9c5,{cwd:_0xae4a38}={}){const _0x13ff25=a40_0x32aa;execSync(_0x13ff25(0xa3)+_0x16c37c+'\x20'+_0x1ee9c5,{'stdio':_0x13ff25(0x91),'cwd':_0xae4a38});}[a40_0x14428d(0x94)](_0x247761,_0x5729c5,_0x4a57d3){const _0x9160ff=a40_0x14428d;existsSync(_0x247761)&&this[_0x9160ff(0x9d)](_0x247761,_0x5729c5,_0x4a57d3);}[a40_0x14428d(0x8f)](){const _0x4c1d87=a40_0x14428d,{output_dir:_0x39cebc}=this['opts'];execSync(_0x4c1d87(0x8c)+_0x39cebc),execSync(_0x4c1d87(0x8c)+this[_0x4c1d87(0x9c)]);}['copySourceFiles'](){const _0x2a8128=a40_0x14428d;log[_0x2a8128(0xa4)]('Coping\x20bot\x20files...'),execSync(_0x2a8128(0x7d)+this['bot_dir']);const {base_dir:_0x121ec8}=this[_0x2a8128(0xb0)];this[_0x2a8128(0x9d)]('*',this[_0x2a8128(0xb4)],{'cwd':_0x121ec8});}['copySharedFiles'](){const _0x1d3a9f=a40_0x14428d;log[_0x1d3a9f(0xa4)](_0x1d3a9f(0xb1));const _0x4625e8=this['opts']['output_dir'];execSync(_0x1d3a9f(0x7d)+_0x4625e8+'/'+this['holder_name']),execSync(_0x1d3a9f(0x7d)+_0x4625e8+_0x1d3a9f(0x7e)),this[_0x1d3a9f(0x94)](this[_0x1d3a9f(0xa8)]+_0x1d3a9f(0x7f),_0x4625e8+_0x1d3a9f(0x7f)),this[_0x1d3a9f(0x94)](this[_0x1d3a9f(0x86)]+_0x1d3a9f(0x9b),_0x4625e8+'/'+this[_0x1d3a9f(0x95)]+'/common/'),this[_0x1d3a9f(0x94)](this[_0x1d3a9f(0x86)]+_0x1d3a9f(0xb3),_0x4625e8+'/'+this[_0x1d3a9f(0x95)]+'/apps');const _0x4b7de0=this['pkg'][_0x1d3a9f(0x96)]||[];for(const _0x39d335 of _0x4b7de0){this['_copyDir'](this[_0x1d3a9f(0xa8)]+_0x1d3a9f(0xb3)+_0x39d335+'/',_0x4625e8+_0x1d3a9f(0xb3)+_0x39d335+'/');}}[a40_0x14428d(0x80)](){const _0xb185d5=a40_0x14428d;log[_0xb185d5(0xa4)]('Install\x20bot\x20dependecies...');const {output_dir:_0x9180f3}=this[_0xb185d5(0xb0)];execSync(_0xb185d5(0xb5),{'stdio':_0xb185d5(0x91),'cwd':_0x9180f3});}['changePkgForDist'](){const _0x2d663b=a40_0x14428d,_0x1e1c54=this[_0x2d663b(0x82)];_0x1e1c54[_0x2d663b(0xa2)]=_0x1e1c54[_0x2d663b(0xa2)]||_0x2d663b(0xa0),_0x1e1c54[_0x2d663b(0xba)]=_0x1e1c54[_0x2d663b(0xba)]||_0x2d663b(0xa6);const _0x4054b5=_0x1e1c54[_0x2d663b(0x9e)]||{},_0x25a629=Array[_0x2d663b(0x84)](_0x4054b5[_0x2d663b(0x8a)])?_0x4054b5[_0x2d663b(0x8a)]:_0x4054b5[_0x2d663b(0x8a)]?[_0x4054b5['assets']]:[];_0x1e1c54[_0x2d663b(0x82)]={'scripts':[_0x2d663b(0x79),..._0x4054b5['scripts']||[]],'assets':['./src/assets/**',_0x2d663b(0x99),..._0x25a629],'outputPath':'dist'},_0x1e1c54[_0x2d663b(0x9f)]={..._0x1e1c54[_0x2d663b(0x9f)],'dist':_0x2d663b(0x8e)},writeFileSync(resolve(this[_0x2d663b(0xb4)],_0x2d663b(0x88)),JSON[_0x2d663b(0x89)](_0x1e1c54));}[a40_0x14428d(0xa1)](){const _0xbab00f=a40_0x14428d;this[_0xbab00f(0x8f)](),this[_0xbab00f(0xb8)](),this['copySharedFiles'](),this['createWorkspacePkgJson'](),this[_0xbab00f(0x85)](),this[_0xbab00f(0x80)](),execSync('yarn\x20dist',{'stdio':_0xbab00f(0x91),'cwd':this[_0xbab00f(0xb4)]});}[a40_0x14428d(0x98)](){const _0x24ef54=a40_0x14428d;execSync('mv\x20'+this['dist_dir']+'\x20'+this[_0x24ef54(0xb0)][_0x24ef54(0x7c)]+_0x24ef54(0xae));}[a40_0x14428d(0xa7)](){const _0x1ef86f=a40_0x14428d;execSync(_0x1ef86f(0x8c)+this['opts']['base_dir']+'/dist');}[a40_0x14428d(0xb2)](){const _0x270745=a40_0x14428d,_0x20a81a={'name':'bots','private':!![],'workspaces':{'packages':[basename(this[_0x270745(0xb4)]),_0x270745(0xad),'apps/*',this[_0x270745(0x95)]+'/*']},'author':_0x270745(0x8b),'license':_0x270745(0xaa)};writeFileSync(resolve(this['opts'][_0x270745(0x81)],'package.json'),JSON[_0x270745(0x89)](_0x20a81a));}}module['exports']=BotDistributor;