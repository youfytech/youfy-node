const a65_0xad9850=a65_0x3852;function a65_0x3852(_0x440cd4,_0x52f24e){const _0x1c5e3a=a65_0x1c5e();return a65_0x3852=function(_0x385249,_0x2c21b0){_0x385249=_0x385249-0xeb;let _0x1e8824=_0x1c5e3a[_0x385249];return _0x1e8824;},a65_0x3852(_0x440cd4,_0x52f24e);}function a65_0x1c5e(){const _0x193101=['\x27s\x20text...','.\x20Amount\x20of\x20items:\x20','4086axNbam','447622stRZnL','\x20from\x20','__cleanup','company_id','120SdnBDY','init','5FIpATm','12812761nYRfTE','output_dir','9PyqpVA','36yJHJNp','template','length','rules','6390wvNVxF','1009488HnlkMb','.\x20Similarity:\x20','cleanup','5218mbaEGQ','name','748242MgKGgd','343pBxJVn','3373902tzDaiH','Extracting\x20','exports','readImage','config','OCR\x20Template\x20not\x20found.','readPDF','info','muted','yfy-ocr','Template\x20found:\x20'];a65_0x1c5e=function(){return _0x193101;};return a65_0x1c5e();}(function(_0x4e17d6,_0x1faf1b){const _0x704ec2=a65_0x3852,_0x36192a=_0x4e17d6();while(!![]){try{const _0x260883=-parseInt(_0x704ec2(0x105))/0x1*(parseInt(_0x704ec2(0x102))/0x2)+-parseInt(_0x704ec2(0xf9))/0x3*(parseInt(_0x704ec2(0xff))/0x4)+-parseInt(_0x704ec2(0xf6))/0x5*(-parseInt(_0x704ec2(0x106))/0x6)+parseInt(_0x704ec2(0xf0))/0x7*(-parseInt(_0x704ec2(0xf4))/0x8)+-parseInt(_0x704ec2(0xef))/0x9*(parseInt(_0x704ec2(0xfe))/0xa)+-parseInt(_0x704ec2(0x104))/0xb+-parseInt(_0x704ec2(0xfa))/0xc*(-parseInt(_0x704ec2(0xf7))/0xd);if(_0x260883===_0x1faf1b)break;else _0x36192a['push'](_0x36192a['shift']());}catch(_0x26a4f1){_0x36192a['push'](_0x36192a['shift']());}}}(a65_0x1c5e,0x8639b));const os=require('os'),{resolve}=require('path'),convertPDF=require('../ocr/convertPDF'),cropImage=require('../ocr/cropImage'),readImage=require('../ocr/readImage'),readLargeImage=require('../ocr/readLargeImage'),OCRTemplateApi=require('../api/OCRTemplate'),{existsSync,mkdirSync,rmSync}=require('fs'),logger=require('../sdk/Logger'),{ValidationError}=require('../exceptions');class OCR{[a65_0xad9850(0xf5)](_0x3156b1={}){const _0x1533cf=a65_0xad9850,_0xf8fa29={'cleanup':!![],..._0x3156b1};this[_0x1533cf(0xf8)]=resolve(os['tmpdir'](),_0x1533cf(0xeb)),_0xf8fa29[_0x1533cf(0x101)]&&this[_0x1533cf(0xf2)](),!existsSync(this['output_dir'])&&mkdirSync(this['output_dir'],{'recursive':!![],'force':!![]});}async[a65_0xad9850(0x10c)](_0x5f1e32){const _0x4ef75a=a65_0xad9850;this[_0x4ef75a(0xf5)]();const _0x9a5167=this[_0x4ef75a(0xf8)],_0x5bd0e1=await convertPDF(_0x5f1e32,{'output_dir':_0x9a5167});return await this[_0x4ef75a(0x109)](_0x5bd0e1,{'cleanup':![]});}async[a65_0xad9850(0x109)](_0x21cf43,_0x5a3726={}){const _0x222d7d=a65_0xad9850;this[_0x222d7d(0xf5)](_0x5a3726);const _0x32b91f=this['output_dir'],_0x56742c=await readLargeImage(_0x21cf43,{'lang':'por','output_dir':_0x32b91f});logger[_0x222d7d(0x10d)]('Finding\x20better\x20template\x20for\x20OCR...');const _0x269097=await OCRTemplateApi['find'](_0x56742c);if(!_0x269097?.[_0x222d7d(0xfb)])throw new ValidationError(_0x222d7d(0x10b));const {items:_0x1d6c54,template:_0x135e4f}=_0x269097,{width:_0xa463cf}=_0x135e4f['file_attributes']||{'width':0x0};logger[_0x222d7d(0x10e)](_0x222d7d(0xec)+_0x135e4f[_0x222d7d(0x103)]+_0x222d7d(0xf1)+_0x135e4f[_0x222d7d(0xf3)]+_0x222d7d(0xee)+_0x1d6c54[_0x222d7d(0xfc)]+_0x222d7d(0x100)+_0x135e4f['similarity']);const _0x20f258={'__template':_0x135e4f};for(const _0x1c4e67 of _0x1d6c54){logger[_0x222d7d(0x10d)](_0x222d7d(0x107)+_0x1c4e67['id']+_0x222d7d(0xed));const _0x10ff57=_0x1c4e67[_0x222d7d(0x10a)][_0x222d7d(0xfd)]||[],_0x1b0018=await cropImage(_0x1c4e67,_0x21cf43,{'output_dir':_0x32b91f,'file_width':_0xa463cf});if(_0x1b0018&&existsSync(_0x1b0018)){const _0x305783=await readImage(_0x1b0018,{'output_dir':_0x32b91f,'rules':_0x10ff57});_0x20f258[_0x1c4e67['id']]=_0x305783;}else _0x20f258[_0x1c4e67['id']]='';}return this['__cleanup'](),_0x20f258;}['__cleanup'](){const _0x5c9887=a65_0xad9850;try{existsSync(this[_0x5c9887(0xf8)])&&rmSync(this[_0x5c9887(0xf8)],{'recursive':!![],'force':!![]});}catch(_0x5f527d){console['warn']('Fail\x20to\x20remove\x20tmp\x20dir',_0x5f527d['message']);}}}module[a65_0xad9850(0x108)]=new OCR();