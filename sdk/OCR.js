function a65_0x2fb8(_0x22332b,_0x54386f){const _0x6cb511=a65_0x6cb5();return a65_0x2fb8=function(_0x2fb8dc,_0x1f4e59){_0x2fb8dc=_0x2fb8dc-0x18f;let _0x3e5d5d=_0x6cb511[_0x2fb8dc];return _0x3e5d5d;},a65_0x2fb8(_0x22332b,_0x54386f);}const a65_0x24b923=a65_0x2fb8;function a65_0x6cb5(){const _0x548b3c=['.\x20Similarity:\x20','3YKJEGz','1378521yKrfjW','name','find','392154uWWMIb','__cleanup','88naugWI','19390WfTwRw','\x20from\x20','Finding\x20better\x20template\x20for\x20OCR...','yfy-ocr','Template\x20found:\x20','readPDF','readImage','message','company_id','template','tmpdir','Extracting\x20','init','1808358hKguvV','info','OCR\x20Template\x20not\x20found.','\x27s\x20text...','por','cleanup','634192supgxQ','output_dir','2836552OvwpdP','similarity','52574cHJqNV','length','muted','file_attributes'];a65_0x6cb5=function(){return _0x548b3c;};return a65_0x6cb5();}(function(_0x25bf99,_0x3a925c){const _0x39d1e9=a65_0x2fb8,_0xecbce2=_0x25bf99();while(!![]){try{const _0x54dff9=-parseInt(_0x39d1e9(0x1a6))/0x1+-parseInt(_0x39d1e9(0x1a2))/0x2*(-parseInt(_0x39d1e9(0x1ab))/0x3)+parseInt(_0x39d1e9(0x1b1))/0x4*(parseInt(_0x39d1e9(0x18f))/0x5)+parseInt(_0x39d1e9(0x19c))/0x6+parseInt(_0x39d1e9(0x1af))/0x7+-parseInt(_0x39d1e9(0x1a4))/0x8+-parseInt(_0x39d1e9(0x1ac))/0x9;if(_0x54dff9===_0x3a925c)break;else _0xecbce2['push'](_0xecbce2['shift']());}catch(_0x2ed6ea){_0xecbce2['push'](_0xecbce2['shift']());}}}(a65_0x6cb5,0x30b5b));const os=require('os'),{resolve}=require('path'),convertPDF=require('../ocr/convertPDF'),cropImage=require('../ocr/cropImage'),readImage=require('../ocr/readImage'),readLargeImage=require('../ocr/readLargeImage'),OCRTemplateApi=require('../api/OCRTemplate'),{existsSync,mkdirSync,rmSync}=require('fs'),logger=require('../sdk/Logger'),{ValidationError}=require('../exceptions');class OCR{[a65_0x24b923(0x19b)](_0x43ee04={}){const _0x435c4c=a65_0x24b923,_0x262fdc={'cleanup':!![],..._0x43ee04};this[_0x435c4c(0x1a3)]=resolve(os[_0x435c4c(0x199)](),_0x435c4c(0x192)),_0x262fdc[_0x435c4c(0x1a1)]&&this[_0x435c4c(0x1b0)](),!existsSync(this[_0x435c4c(0x1a3)])&&mkdirSync(this[_0x435c4c(0x1a3)],{'recursive':!![],'force':!![]});}async[a65_0x24b923(0x194)](_0x213a9d){const _0xe4006c=a65_0x24b923;this[_0xe4006c(0x19b)]();const _0x3d6052=this[_0xe4006c(0x1a3)],_0x3bad51=await convertPDF(_0x213a9d,{'output_dir':_0x3d6052});return await this[_0xe4006c(0x195)](_0x3bad51,{'cleanup':![]});}async['readImage'](_0x3f033,_0x36c71d={}){const _0x22d61c=a65_0x24b923;this['init'](_0x36c71d);const _0x450fe1=this[_0x22d61c(0x1a3)],_0x31d98b=await readLargeImage(_0x3f033,{'lang':_0x22d61c(0x1a0),'output_dir':_0x450fe1});logger[_0x22d61c(0x19d)](_0x22d61c(0x191));const _0x43837b=await OCRTemplateApi[_0x22d61c(0x1ae)](_0x31d98b);if(!_0x43837b?.[_0x22d61c(0x198)])throw new ValidationError(_0x22d61c(0x19e));const {items:_0x31730f,template:_0x488a92}=_0x43837b,{width:_0x5a6af9}=_0x488a92[_0x22d61c(0x1a9)]||{'width':0x0};logger[_0x22d61c(0x1a8)](_0x22d61c(0x193)+_0x488a92[_0x22d61c(0x1ad)]+_0x22d61c(0x190)+_0x488a92[_0x22d61c(0x197)]+'.\x20Amount\x20of\x20items:\x20'+_0x31730f[_0x22d61c(0x1a7)]+_0x22d61c(0x1aa)+_0x488a92[_0x22d61c(0x1a5)]);const _0x2cf6d4={'__template':_0x488a92};for(const _0x1e7ad7 of _0x31730f){logger['info'](_0x22d61c(0x19a)+_0x1e7ad7['id']+_0x22d61c(0x19f));const _0x397f6a=_0x1e7ad7['config']['rules']||[],_0x57fb4b=await cropImage(_0x1e7ad7,_0x3f033,{'output_dir':_0x450fe1,'file_width':_0x5a6af9});if(_0x57fb4b&&existsSync(_0x57fb4b)){const _0x1c2eb7=await readImage(_0x57fb4b,{'output_dir':_0x450fe1,'rules':_0x397f6a});_0x2cf6d4[_0x1e7ad7['id']]=_0x1c2eb7;}else _0x2cf6d4[_0x1e7ad7['id']]='';}return this['__cleanup'](),_0x2cf6d4;}[a65_0x24b923(0x1b0)](){const _0x50a595=a65_0x24b923;try{existsSync(this[_0x50a595(0x1a3)])&&rmSync(this['output_dir'],{'recursive':!![],'force':!![]});}catch(_0x5672a8){console['warn']('Fail\x20to\x20remove\x20tmp\x20dir',_0x5672a8[_0x50a595(0x196)]);}}}module['exports']=new OCR();