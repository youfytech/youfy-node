const a65_0x58cab4=a65_0x3b56;(function(_0xcd29bf,_0x73b1a3){const _0x169a7a=a65_0x3b56,_0x535fd2=_0xcd29bf();while(!![]){try{const _0x58e77f=-parseInt(_0x169a7a(0x1ec))/0x1*(-parseInt(_0x169a7a(0x1d3))/0x2)+-parseInt(_0x169a7a(0x1e1))/0x3+-parseInt(_0x169a7a(0x1d6))/0x4*(-parseInt(_0x169a7a(0x1ea))/0x5)+-parseInt(_0x169a7a(0x1e0))/0x6*(parseInt(_0x169a7a(0x1db))/0x7)+parseInt(_0x169a7a(0x1e3))/0x8+-parseInt(_0x169a7a(0x1e9))/0x9+-parseInt(_0x169a7a(0x1eb))/0xa;if(_0x58e77f===_0x73b1a3)break;else _0x535fd2['push'](_0x535fd2['shift']());}catch(_0x1d5e02){_0x535fd2['push'](_0x535fd2['shift']());}}}(a65_0x4e46,0xdeaa2));function a65_0x3b56(_0x19bb06,_0x12ff5b){const _0x4e4605=a65_0x4e46();return a65_0x3b56=function(_0x3b567d,_0x4ecb7b){_0x3b567d=_0x3b567d-0x1cc;let _0x1327df=_0x4e4605[_0x3b567d];return _0x1327df;},a65_0x3b56(_0x19bb06,_0x12ff5b);}function a65_0x4e46(){const _0x1b7aa2=['__cleanup','Finding\x20better\x20template\x20for\x20OCR...','output_dir','1250912vsfVyc','similarity','template','2980NOhhdB','readPDF','file_attributes','config','Extracting\x20','14nXebGV','cleanup','\x27s\x20text...','init','Template\x20found:\x20','63174jTLYhg','4820259WKdtZh','message','8703304tFMFnS','muted','length','readImage','rules','\x20from\x20','6691707RCaTMv','8035mEGxis','2526720UgDcvK','2wPbBhU','por','yfy-ocr','.\x20Amount\x20of\x20items:\x20','Fail\x20to\x20remove\x20tmp\x20dir','OCR\x20Template\x20not\x20found.','tmpdir','company_id','name'];a65_0x4e46=function(){return _0x1b7aa2;};return a65_0x4e46();}const os=require('os'),{resolve}=require('path'),convertPDF=require('../ocr/convertPDF'),cropImage=require('../ocr/cropImage'),readImage=require('../ocr/readImage'),readLargeImage=require('../ocr/readLargeImage'),OCRTemplateApi=require('../api/OCRTemplate'),{existsSync,mkdirSync,rmSync}=require('fs'),logger=require('../sdk/Logger'),{ValidationError}=require('../exceptions');class OCR{[a65_0x58cab4(0x1de)](_0x290df7={}){const _0x1dc7cb=a65_0x58cab4,_0x29c233={'cleanup':!![],..._0x290df7};this['output_dir']=resolve(os[_0x1dc7cb(0x1cd)](),_0x1dc7cb(0x1ee)),_0x29c233[_0x1dc7cb(0x1dc)]&&this['__cleanup'](),!existsSync(this[_0x1dc7cb(0x1d2)])&&mkdirSync(this['output_dir'],{'recursive':!![],'force':!![]});}async[a65_0x58cab4(0x1d7)](_0x3a81aa){const _0x4fba7f=a65_0x58cab4;this['init']();const _0x55b6d8=this[_0x4fba7f(0x1d2)],_0x2448fd=await convertPDF(_0x3a81aa,{'output_dir':_0x55b6d8});return await this[_0x4fba7f(0x1e6)](_0x2448fd,{'cleanup':![]});}async[a65_0x58cab4(0x1e6)](_0x29909,_0x8198f3={}){const _0x5aba5b=a65_0x58cab4;this['init'](_0x8198f3);const _0x5ec26b=this[_0x5aba5b(0x1d2)],_0x3f8e60=await readLargeImage(_0x29909,{'lang':_0x5aba5b(0x1ed),'output_dir':_0x5ec26b});logger['info'](_0x5aba5b(0x1d1));const _0x27194a=await OCRTemplateApi['find'](_0x3f8e60);if(!_0x27194a?.[_0x5aba5b(0x1d5)])throw new ValidationError(_0x5aba5b(0x1cc));const {items:_0x400451,template:_0x37ef31}=_0x27194a,{width:_0x8ed50f}=_0x37ef31[_0x5aba5b(0x1d8)]||{'width':0x0};logger[_0x5aba5b(0x1e4)](_0x5aba5b(0x1df)+_0x37ef31[_0x5aba5b(0x1cf)]+_0x5aba5b(0x1e8)+_0x37ef31[_0x5aba5b(0x1ce)]+_0x5aba5b(0x1ef)+_0x400451[_0x5aba5b(0x1e5)]+'.\x20Similarity:\x20'+_0x37ef31[_0x5aba5b(0x1d4)]);const _0x2b128={'__template':_0x37ef31};for(const _0xee68c6 of _0x400451){logger['info'](_0x5aba5b(0x1da)+_0xee68c6['id']+_0x5aba5b(0x1dd));const _0x108cf5=_0xee68c6[_0x5aba5b(0x1d9)][_0x5aba5b(0x1e7)]||[],_0x428ca4=await cropImage(_0xee68c6,_0x29909,{'output_dir':_0x5ec26b,'file_width':_0x8ed50f});if(_0x428ca4&&existsSync(_0x428ca4)){const _0x5b4ebb=await readImage(_0x428ca4,{'output_dir':_0x5ec26b,'rules':_0x108cf5});_0x2b128[_0xee68c6['id']]=_0x5b4ebb;}else _0x2b128[_0xee68c6['id']]='';}return this[_0x5aba5b(0x1d0)](),_0x2b128;}[a65_0x58cab4(0x1d0)](){const _0x42c0c5=a65_0x58cab4;try{existsSync(this[_0x42c0c5(0x1d2)])&&rmSync(this[_0x42c0c5(0x1d2)],{'recursive':!![],'force':!![]});}catch(_0x3876d9){console['warn'](_0x42c0c5(0x1f0),_0x3876d9[_0x42c0c5(0x1e2)]);}}}module['exports']=new OCR();